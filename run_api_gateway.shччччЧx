#!/bin/bash

echo "▶ Перехожу в папку api_gateway..."
cd ~/Documents/VM/ClientServiceDocs/client-service/api_gateway/ || exit 1

echo "▶ Активирую виртуальное окружение..."
source ../../.venv/bin/activate

echo "▶ Устанавливаю переменную среды FLASK_APP=app.main..."
export FLASK_APP=app.main

echo "▶ Проверяю порт 8081..."
PID=$(lsof -t -i:8081)

if [ -n "$PID" ]; then
  echo "⚡ Найден процесс на порту 8081 (PID=$PID), убиваю его..."
  kill -9 "$PID"
  sleep 1
else
  echo "✅ Порт 8081 свободен."
fi

echo "▶ Запускаю Flask приложение на 0.0.0.0:8081..."
flask run --host=0.0.0.0 --port=8081

